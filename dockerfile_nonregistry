############################################################
# Dockerfile skeleton for manual images to build images for bumblebee
# DO NOT EDIT THIS FILE MANUALLY
# Variables will be inserted automatically via create-container.py
# Modify the environment variables there instead
############################################################

# Set the base image to RHEL version
FROM rhel$osversion

# Setup yum configuration and entitlements for container
# This is only necessary for RHEL6.0 - 6.5 containers as they are not in the official Red Hat registry
# and have been built manually
COPY /etc/pki/entitlement/*.pem /etc/pki/entitlement/
COPY /etc/pki/entitlement/*-key.pem /etc/pki/entitlement/
COPY /etc/rhsm/ca/* /etc/rhsm-host/ca/ 
COPY /etc/rhsm/rhsm.conf /etc/rhsm-host/rhsm.conf 

# Add the core file to the container
COPY $corefile /

# Set WORKDIR to directory containing core file
WORKDIR /

# The rpmdb likes to corrupt inside the container, so lets make sure that yum runs fine by rebuilding the db
# then we'll install all of our debuginfos 
# We have to do this in one RUN command to make sure the rpmdb doesn't recorrupt across intermediary containers 
RUN rpm --rebuilddb ; yum -y install gdb gcc elfutils $pkgversion ; yum --enablerepo='*-debug' -y install $(echo $pkgversion  sed -e '0,/-/{s/-/-debuginfo-/}') ; yum --enablerepo='*-debug*' -y install $(eu-unstrip -n --core=/$corefile | sed -e 's#^[^ ]* \(..\)\([^@ ]*\).*$#/usr/lib/debug/.build-id/\1/\2#p' -e 's/$/.debug/')
